    <!doctype html>
    <html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        

        <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
        <!-- App css-->
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <title>Gird Payout</title>
        <style>
            body{
                width:100%;
                padding:20px;
            }
        /* hide featch grid data table on loading page */
            {% comment %} #ratetable {
                display: none;
            } {% endcomment %}
        </style>
    </head>
    <body>
        <div class="container-fluid general-widget">

              <!-- header start-->
        <header class="landing-header">
            <div class="custom-container">
              <div class="row">
                <div class="col-12">
                  <nav class="navbar navbar-light p-0" id="navbar-example2"><a class="navbar-brand" style=" color:#0c7097;">{{request.user.username}}</a>
                  
                            <div class="btn btn-primary-light" ><a href="{% url 'accounts:password_change' request.user.username %}" style="border-radius: 0px;
                                color: #fff;
                                background-color: #0c7097;
                                padding: 10px 25px;
                                line-height: 1;
                                font-weight: 600;
                                display: block;
                                " >
                                Change Password</a>
                              
                            </div>
                            <div class="btn btn-primary-light" ><a href="{% url 'accounts:logout' %}" style="border-radius: 0px;
                        color: #fff;
                        background-color: #0c7097;
                        padding: 10px 25px;
                        line-height: 1;
                        font-weight: 600;
                        display: block;
                        width: -webkit-fit-content;
                        width: -moz-fit-content;
                        width: fit-content;" >
                         Logout</a>
                      
                    </div>
                  </nav>
                </div>
              </div>
            </div>
          </header>
          <!-- header end-->
          
            <div class="card">
                <div class="card-header" style="background: #0c7097; color:white;" >
    View Rate</div>

        <div class="card">
            <div class="card-header pb-0">

    
    
        <form class="form theme-form" method="POST" action="" enctype="multipart/form-data">
            {% csrf_token %}
            {% comment %} <a href="#" value="{{request.user.username}}">{{request.user.username}}</a>
            <a href="{% url 'accounts:logout' %}">logout</a> {% endcomment %}

            <div class="form-row">
                <div class="col-md-4 col-sm-12 form-group">
                    <label for="companyoptions">Provider</label>
                    <select id="companyoptions" class="form-control" name="company" multiple>
                        <option value="" selected>Select Company</option>
                        {% for company in companys %}
                            <option value="{{ company.company }}">{{ company.company }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 col-sm-12 form-group">
                    <label for="productoptions">Product</label>
                    <select id="productoptions" class="form-control" name="product">
                        <option value="" selected>Select Product</option>
                    </select>
                    <div id="productError" class="text-danger"></div>
                </div>

                <div class="col-md-4 col-sm-12 form-group">
                    <label for="vehicaltypeoptions">Vehicle Type</label>
                    <select id="vehicaltypeoptions" class="form-control" name="vehical_type">
                        <option value="" selected>Select Vehicle Type</option>
                    </select>
                </div>

                <div class="col-md-4 col-sm-12 form-group">
                    <label for="vehicalsubtypeoptions">Vehicle Sub Type</label>
                    <select id="vehicalsubtypeoptions" class="form-control" name="vehical_subtype">
                        <option value="" selected>Select Vehicle Sub Type</option>
                    </select>
                </div> 

                <div class="col-md-4 col-sm-12 form-group">
                    <label for="productnameoptions">Product Name</label>
                    <select id="productnameoptions" class="form-control" name="product_name">
                        <option value="" selected>Select Product Name</option>
                    </select>
                </div>
                <div class="col-md-4 col-sm-12 form-group">
                    <label for="monthoptions">Month</label>
                    <select id="monthoptions" class="form-control" name="month">
                        <option value="" selected>Select Month</option>
                    </select>
                </div>
                <div class="col-md-4 col-sm-12 form-group">
                    <label for="stateoptions">State</label>
                    <select id="stateoptions" class="form-control" name="state">
                        <option value="" selected>Select State</option>
                    </select>
                </div>
                <div class="col-md-3 col-sm-12 form-group">
                    <label for="rtooptions">RTO</label>
                    <select id="rtooptions" class="form-control" name="rto">
                        <option value="" selected>Select RTO</option>
                    </select>
                </div>

                {% comment %} <div class="col-md-4 col-sm-12 form-group">
                    <label for="vehicaltypeoptions">Vehicle Type</label>
                    <select id="vehicaltypeoptions" class="form-control" name="vehical_type">
                        <option value="" selected>Select Vehicle Type</option>
                    </select>
                </div>
                <div class="col-md-4 col-sm-12 form-group">
                    <label for="vehicalsubtypeoptions">Vehicle Sub Type</label>
                    <select id="vehicalsubtypeoptions" class="form-control" name="vehical_subtype">
                        <option value="" selected>Select Vehicle Sub Type</option>
                    </select>
                </div> {% endcomment %}
               
                
                
            
            </div>
        </form>


<!-- Add the following HTML to your template -->
<div class="card">
    <!-- Additional form elements and buttons go here -->
    <div class="card-body">
        <div class="dt-ext table-responsive">
            <table id="ratetable" class="table table-hover mb-2">
                <thead class="table-active">
                    <tr>
                        <th style="background: #0c7097; color:white;">Company</th>
                        {% comment %} <th style="background: #0c7097; color:white;">vehical_type</th>
                       <th style="background: #0c7097; color:white;">Vehicle Subtype</th> {% endcomment %}
                        <th style="background: #0c7097; color:white;">Remarks</th>
                        {% comment %} <th>Rate</th> {% endcomment %}
                        <th style="background: #0c7097; color:white;">Point OD</th>
                        <th style="background: #0c7097; color:white;">Point TP</th>
                        <th style="background: #0c7097; color:white;">Point NET</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows will be dynamically added here -->
                </tbody>
            </table>
        </div>
    </div>
</div>
</div>
  </div>
     <!-- Add the following JavaScript to your template -->
       <!-- Add the following JavaScript to your template -->
       <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
       <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
       <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
       <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
       
<!-- Add the following script to initialize Select2 on the companyoptions select element -->
{% comment %} <script>
    $(document).ready(function() {
        $('#companyoptions').select2();
    });
</script> {% endcomment %}

<!-- Modify your existing AJAX function for loading products -->
<script>
    $("#companyoptions").change(function () {
        var company_ids = $(this).val();  // Use val() to get selected values as an array

        $.ajax({
            url: "{% url 'grid:ajax_load_product' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
            },
            success: function (data) {
                var productSelect = $("#productoptions");
                productSelect.empty();  // Clear existing options

                var products = data.products;
                productSelect.append(
                    $("<option>").attr('value', "").text("Select product")
                );

                for (var i = 0; i < products.length; i++) {
                    productSelect.append(
                        $("<option>").attr('value', products[i].product).text(products[i].product)
                    );
                }
            }
        });
    });

</script>

<script>
    $("#companyoptions, #productoptions").change(function () {
        var company_ids = $("#companyoptions").val();  // Use val() to get selected values as an array
        var product_id = $("#productoptions").val();

        $.ajax({
            url: "{% url 'grid:ajax_load_vehical_type' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
                'product': product_id,
            },
            success: function (data) {
                var vehicaltypeSelect = $("#vehicaltypeoptions");
                vehicaltypeSelect.empty();  // Clear existing options

                var vehicaltypes = data.vehical_types;
                vehicaltypeSelect.append(
                    $("<option>").attr('value', "").text("Select Vehicle Type")
                );

                for (var i = 0; i < vehicaltypes.length; i++) {
                    vehicaltypeSelect.append(
                        $("<option>").attr('value', vehicaltypes[i].vehical_type).text(vehicaltypes[i].vehical_type)
                    );
                }
            }
        });
    });
</script>


<!-- Modify your existing AJAX function for loading product names -->
<script>
    $("#companyoptions, #productoptions, #vehicaltypeoptions").change(function () {
        var company_ids = $("#companyoptions").val();  // Use val() to get selected values as an array
        var product_id = $("#productoptions").val();
        var vehical_type = $("#vehicaltypeoptions").val();

        $.ajax({
            url: "{% url 'grid:ajax_load_vehical_subtype' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
                'product': product_id,
                'vehical_type': vehical_type,
            },
            success: function (data) {
                var vehicalsubtypeSelect = $("#vehicalsubtypeoptions");
                vehicalsubtypeSelect.empty();  // Clear existing options

                var vehicalsubtypes = data.vehical_subtypes;
                vehicalsubtypeSelect.append(
                    $("<option>").attr('value', "").text("Select Vehicle Subtype")
                );

                for (var i = 0; i < vehicalsubtypes.length; i++) {
                    vehicalsubtypeSelect.append(
                        $("<option>").attr('value', vehicalsubtypes[i].vehical_subtype).text(vehicalsubtypes[i].vehical_subtype)
                    );
                }
            }
        });
    });
</script>

<!-- Modify your existing AJAX function for loading product names -->
<script>
    $("#companyoptions, #productoptions, #vehicaltypeoptions").change(function () {
        var company_ids = $("#companyoptions").val();  // Use val() to get selected values as an array
        var product_id = $("#productoptions").val();
        var vehical_type = $("#vehicaltypeoptions").val();

        $.ajax({
            url: "{% url 'grid:ajax_load_vehical_subtype' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
                'product': product_id,
                'vehical_type': vehical_type,
            },
            success: function (data) {
                var vehicalsubtypeSelect = $("#vehicalsubtypeoptions");
                vehicalsubtypeSelect.empty();  // Clear existing options

                var vehicalsubtypes = data.vehical_subtypes;
                vehicalsubtypeSelect.append(
                    $("<option>").attr('value', "").text("Select Vehicle Subtype")
                );

                for (var i = 0; i < vehicalsubtypes.length; i++) {
                    vehicalsubtypeSelect.append(
                        $("<option>").attr('value', vehicalsubtypes[i].vehical_subtype).text(vehicalsubtypes[i].vehical_subtype)
                    );
                }

                // Trigger the change event on the vehicalsubtypeoptions select to load product names
                vehicalsubtypeSelect.trigger('change');
            }
        });
    });

    // Load product names based on selected company, product, and vehicle type
    $("#companyoptions, #productoptions, #vehicaltypeoptions, #vehicalsubtypeoptions").change(function () {
        var company_ids = $("#companyoptions").val();  // Use val() to get selected values as an array
        var product_id = $("#productoptions").val();
        var vehical_type = $("#vehicaltypeoptions").val();
        var vehical_subtype = $("#vehicalsubtypeoptions").val();

        $.ajax({
            url: "{% url 'grid:ajax_load_product_name' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
                'product': product_id,
                'vehical_type': vehical_type,
                'vehical_subtype': vehical_subtype,
            },
            success: function (data) {
                var productnameSelect = $("#productnameoptions");
                productnameSelect.empty();  // Clear existing options

                var productnames = data.product_names;
                productnameSelect.append(
                    $("<option>").attr('value', "").text("Select Product Name")
                );

                for (var i = 0; i < productnames.length; i++) {
                    productnameSelect.append(
                        $("<option>").attr('value', productnames[i].product_name).text(productnames[i].product_name)
                    );
                }
            }
        });
    });
</script>
<!-- Modify your existing AJAX function for loading months -->
<script>
    $("#companyoptions, #productoptions,#vehicaltypeoptions,#vehicalsubtypeoptions,#productnameoptions").change(function () {
        var company_ids = $("#companyoptions").val();  // Use val() to get selected values as an array
        var product_id = $("#productoptions").val();
        var vehical_type = $("#vehicaltypeoptions").val();
        var vehical_subtype = $("#vehicalsubtypeoptions").val();
        var product_name_id = $("#productnameoptions").val();

        $.ajax({
            url: "{% url 'grid:ajax_load_month' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
                'product': product_id,
                'vehical_type': vehical_type,
                'vehical_subtype': vehical_subtype,
                'product_name': product_name_id
                
            },
            success: function (data) {
                var monthSelect = $("#monthoptions");
                monthSelect.empty();  // Clear existing options

                var months = data.months;
                monthSelect.append(
                    $("<option>").attr('value', "").text("Select Month")
                );

                for (var i = 0; i < months.length; i++) {
                    monthSelect.append(
                        $("<option>").attr('value', months[i].month).text(months[i].month)
                    );
                }
            }
        });
    });
</script>
<!-- Modify your existing AJAX function for loading states -->
<script>
    $("#companyoptions, #productoptions,#vehicaltypeoptions,#vehicalsubtypeoptions, #productnameoptions, #monthoptions").change(function () {
        var company_ids = $("#companyoptions").val();  // Use val() to get selected values as an array
        var product_id = $("#productoptions").val();
        var vehical_type = $("#vehicaltypeoptions").val();
        var vehical_subtype = $("#vehicalsubtypeoptions").val();
        var product_name_id = $("#productnameoptions").val();
        var month_id = $("#monthoptions").val();

        $.ajax({
            url: "{% url 'grid:ajax_load_state' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
                'product': product_id,
                'vehical_type': vehical_type,
                'vehical_subtype': vehical_subtype,
                'product_name': product_name_id,
                'month': month_id
            },
            success: function (data) {
                var stateSelect = $("#stateoptions");
                stateSelect.empty();  // Clear existing options

                var states = data.states;
                stateSelect.append(
                    $("<option>").attr('value', "").text("Select State")
                );

                for (var i = 0; i < states.length; i++) {
                    stateSelect.append(
                        $("<option>").attr('value', states[i].state).text(states[i].state)
                    );
                }
            }
        });
    });
</script>
<!-- Modify your existing AJAX function for loading RTOs -->
<script>
    $("#companyoptions, #productoptions,#vehicaltypeoptions,#vehicalsubtypeoptions, #productnameoptions, #monthoptions, #stateoptions").change(function () {
        var company_ids = $("#companyoptions").val();  // Use val() to get selected values as an array
        var product_id = $("#productoptions").val();
        var vehical_type = $("#vehicaltypeoptions").val();
        var vehical_subtype = $("#vehicalsubtypeoptions").val();
        var product_name_id = $("#productnameoptions").val();
        var month_id = $("#monthoptions").val();
        var state_id = $("#stateoptions").val();

        $.ajax({
            url: "{% url 'grid:ajax_load_rto' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
                'product': product_id,
                'vehical_type': vehical_type,
                'vehical_subtype': vehical_subtype,
                'product_name': product_name_id,
                'month': month_id,
                'state': state_id
            },
            success: function (data) {
                var rtoSelect = $("#rtooptions");
                rtoSelect.empty();  // Clear existing options

                var rtos = data.rtos;
                rtoSelect.append(
                    $("<option>").attr('value', "").text("Select RTO")
                );

                for (var i = 0; i < rtos.length; i++) {
                    rtoSelect.append(
                        $("<option>").attr('value', rtos[i].rto).text(rtos[i].rto)
                    );
                }
            }
        });
    });
</script>
<!-- Modify your existing AJAX function for loading data -->
<!-- Add the following JavaScript to your template -->

    <script>
        $(document).ready(function () {
            $("#companyoptions, #productoptions, #vehicaltypeoptions,#vehicalsubtypeoptions, #productnameoptions, #monthoptions, #stateoptions, #rtooptions").change(function () {
                var company_ids = $("#companyoptions").val();
                var product_id = $("#productoptions").val();
                var vehical_type = $("#vehicaltypeoptions").val();
                var vehical_subtype = $("#vehicalsubtypeoptions").val();
                var product_name_id = $("#productnameoptions").val();
                var month_id = $("#monthoptions").val();
                var state_id = $("#stateoptions").val();
                var rto_id = $("#rtooptions").val();
    
                // Add checks to see if a selection has been made in each dropdown
                if (company_ids && product_id && vehical_type && product_name_id && month_id && state_id && rto_id) {
                    $.ajax({
                        url: "{% url 'grid:ajax_load_rate_remarks_agent_payout' %}",
                        data: {
                            'company': company_ids.join(),
                            'product': product_id,
                            'vehical_type': vehical_type,
                            'vehical_subtype': vehical_subtype,
                            'product_name': product_name_id,
                            'month': month_id,
                            'state': state_id,
                            'rto': rto_id
                        },
                        success: function (data) {
                            var tableBody = $("#ratetable tbody");
                            tableBody.empty();
    
                            for (var i = 0; i < data.results.length; i++) {
                                var result = data.results[i];
    
                                var newRow = $("<tr>");
                                // Use 'input' instead of 'textarea' for single-line input
                                newRow.append("<td><p class='form-control text-wrap border-0 mb-0 h-auto  bg-transparent' style='min-width:200px'  readonly>" + result.company + "</p></td>");


                                newRow.append("<td><p class='form-control text-wrap border-0 mb-0 h-auto  bg-transparent' readonly>"  + result.remarks + "</p></td>");
                                //newRow.append("<td><textarea rows='2' cols='50' class='form-control' readonly>" + result.remarks + "</textarea></td>");
                                var userGroup = '{{ request.user.groups.all.0.name }}';
    
                                if (userGroup === 'RateUser1') {
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser1_od +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser1_tp +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser1_net +  "</p></td>");
                                } else if (userGroup === 'RateUser2') {
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser2_od +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser2_tp +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser2_net +  "</p></td>");
                                } else if (userGroup === 'RateUser3') {
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' readonly>" + result.rateuser3_od +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' readonly>" + result.rateuser3_tp +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' readonly>" + result.rateuser3_net +  "</p></td>");
                                } else {
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser1_od +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser1_tp +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser1_net +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser2_od +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser2_tp +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser2_net +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser3_od +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser3_tp +  "</p></td>");
                                    newRow.append("<td><p class='border-0 mb-0 bg-transparent' style='min-width:100px'  readonly>" + result.rateuser3_net +  "</p></td>");

                                }
    
                                tableBody.append(newRow);
                            }
                        }
                    });
                }
            });
        });
    </script>



</div>
</div>

    </body>
    </html>